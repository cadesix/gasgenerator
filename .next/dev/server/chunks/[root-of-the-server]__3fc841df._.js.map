{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/cade/Desktop/gen-ad-scripts/lib/db/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = globalThis as unknown as {\n  prisma: PrismaClient | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? new PrismaClient()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///Users/cade/Desktop/gen-ad-scripts/lib/ai/claude.ts"],"sourcesContent":["import Anthropic from '@anthropic-ai/sdk'\nimport { Project, ScriptFormat } from '@prisma/client'\n\nconst client = new Anthropic({\n  apiKey: process.env.ANTHROPIC_API_KEY,\n})\n\nexport interface ScriptVariation {\n  [sectionName: string]: string\n}\n\nfunction getSections(format?: ScriptFormat | null): string[] {\n  if (!format) return ['hook', 'body']\n  try {\n    const sections = JSON.parse(format.sections) as string[]\n    return sections.length > 0 ? sections : ['hook', 'body']\n  } catch {\n    return ['hook', 'body']\n  }\n}\n\nexport async function generateScripts({\n  project,\n  format,\n  batchInstructions,\n}: {\n  project: Project\n  format?: ScriptFormat | null\n  batchInstructions?: string\n}): Promise<ScriptVariation[]> {\n  const sections = getSections(format)\n  const prompt = buildPrompt(project, format, sections, batchInstructions)\n\n  const response = await client.messages.create({\n    model: 'claude-sonnet-4-20250514',\n    max_tokens: 4000,\n    messages: [\n      {\n        role: 'user',\n        content: prompt,\n      },\n    ],\n  })\n\n  const content = response.content[0]\n  if (content.type !== 'text') {\n    throw new Error('Unexpected response type from Claude')\n  }\n  return parseScriptResponse(content.text, sections)\n}\n\nexport async function repromptScript({\n  project,\n  format,\n  currentContent,\n  batchInstructions,\n  repromptContext,\n}: {\n  project: Project\n  format?: ScriptFormat | null\n  currentContent: Record<string, string>\n  batchInstructions?: string\n  repromptContext: string\n}): Promise<Record<string, string>> {\n  const sections = getSections(format)\n  const examples = JSON.parse(project.examples) as string[]\n  const formatExamples = format ? (JSON.parse(format.examples) as string[]) : []\n\n  const projectContext = `App: ${project.name}\nDescription: ${project.description}\nTarget Audience: ${project.targetAudience}\n${examples.length > 0 ? `\\nExample scripts:\\n${examples.join('\\n\\n')}` : ''}`\n\n  const currentScriptText = sections\n    .map((section) => `${section}: \"${currentContent[section] || ''}\"`)\n    .join('\\n')\n\n  const sectionsStructure = sections.map((s) => `\"${s}\": \"text here\"`).join(',\\n  ')\n\n  const prompt = `You are a social media ad copywriter creating Instagram ad scripts.\n\nApp Context:\n${projectContext}\n\n${format ? `Format: ${format.structure}\\nVisual Context: ${format.visualDescription}\\n${formatExamples.length > 0 ? `\\nFormat Example Scripts:\\n${formatExamples.join('\\n\\n')}\\n` : ''}` : ''}\n${batchInstructions ? `Additional Context for this batch:\\n${batchInstructions}\\n` : ''}\n\nCURRENT SCRIPT:\n${currentScriptText}\n\nUSER FEEDBACK/CONTEXT:\n${repromptContext}\n\nBased on the user's feedback, regenerate the ENTIRE script incorporating their requested changes while maintaining:\n1. Natural flow between all sections\n2. The app's target audience\n3. A conversational, seamless style\n\nReturn ONLY a JSON object with this structure:\n{\n  ${sectionsStructure}\n}\n\nNo preamble, just the JSON object.`\n\n  const response = await client.messages.create({\n    model: 'claude-sonnet-4-20250514',\n    max_tokens: 2000,\n    messages: [\n      {\n        role: 'user',\n        content: prompt,\n      },\n    ],\n  })\n\n  const content = response.content[0]\n  if (content.type !== 'text') {\n    throw new Error('Unexpected response type from Claude')\n  }\n\n  try {\n    const cleaned = content.text.replace(/```json|```/g, '').trim()\n    const parsed = JSON.parse(cleaned)\n    return parsed\n  } catch (error) {\n    console.error('Error parsing reprompt response:', error)\n    console.error('Response text:', content.text)\n    throw new Error('Failed to parse AI response. Please try again.')\n  }\n}\n\nfunction buildPrompt(\n  project: Project,\n  format: ScriptFormat | null | undefined,\n  sections: string[],\n  batchInstructions?: string\n): string {\n  const examples = JSON.parse(project.examples) as string[]\n  const formatExamples = format ? (JSON.parse(format.examples) as string[]) : []\n\n  const projectContext = `App: ${project.name}\nDescription: ${project.description}\nTarget Audience: ${project.targetAudience}\n${examples.length > 0 ? `\\nExample scripts:\\n${examples.join('\\n\\n')}` : ''}`\n\n  const sectionsDescription = sections\n    .map((section, idx) => `${idx + 1}. ${section.toUpperCase()}`)\n    .join('\\n')\n\n  const sectionsStructure = sections.map((s) => `\"${s}\": \"text here\"`).join(',\\n    ')\n\n  return `You are a social media ad copywriter creating Instagram ad scripts.\n\nApp Context:\n${projectContext}\n\n${format ? `Format: ${format.structure}\\nVisual Context: ${format.visualDescription}\\n${formatExamples.length > 0 ? `\\nFormat Example Scripts:\\n${formatExamples.join('\\n\\n')}\\n` : ''}` : ''}\n${batchInstructions ? `Additional Context for this batch:\\n${batchInstructions}\\n` : ''}\n\nGenerate 10 COMPLETELY DIFFERENT ad scripts. Each script should have these sections:\n${sectionsDescription}\n\nCRITICAL: All sections must flow naturally together. Consider each section's tone, angle, and context when writing the next. The transitions should feel seamless and conversational, not disjointed.\n\nMake the scripts diverse:\n- Different angles appropriate for this app and audience\n- Different tones that match the demographic\n- Different formats (questions, statements, storytelling, reveals)\n\nReturn ONLY a JSON array with this structure:\n[\n  {\n    ${sectionsStructure}\n  }\n]\n\nNo preamble, just the JSON array.`\n}\n\nfunction parseScriptResponse(text: string, sections: string[]): ScriptVariation[] {\n  try {\n    // Clean response by removing code blocks\n    const cleaned = text.replace(/```json|```/g, '').trim()\n    const parsed = JSON.parse(cleaned)\n\n    if (!Array.isArray(parsed) || parsed.length !== 10) {\n      throw new Error('Expected array of 10 scripts')\n    }\n\n    return parsed.map((item: any) => {\n      const script: ScriptVariation = {}\n      sections.forEach((section) => {\n        script[section] = item[section] || ''\n      })\n      return script\n    })\n  } catch (error) {\n    console.error('Error parsing script response:', error)\n    console.error('Response text:', text)\n    throw new Error('Failed to parse AI response. Please try again.')\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///Users/cade/Desktop/gen-ad-scripts/app/api/generate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { prisma } from '@/lib/db/prisma'\nimport { generateScripts } from '@/lib/ai/claude'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { projectId, formatId, batchInstructions } = body\n\n    // Fetch project\n    const project = await prisma.project.findFirst({\n      where: {\n        id: projectId,\n        deletedAt: null\n      },\n    })\n\n    if (!project) {\n      return NextResponse.json(\n        { error: 'Project not found' },\n        { status: 404 }\n      )\n    }\n\n    // Fetch format if provided\n    let format = null\n    if (formatId) {\n      format = await prisma.scriptFormat.findFirst({\n        where: {\n          id: formatId,\n          deletedAt: null\n        },\n      })\n    }\n\n    // Generate scripts using Claude\n    const scripts = await generateScripts({\n      project,\n      format,\n      batchInstructions,\n    })\n\n    return NextResponse.json({ scripts })\n  } catch (error) {\n    console.error('Error generating scripts:', error)\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Failed to generate scripts' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,iBAAiB,EAAE,GAAG;QAEnD,gBAAgB;QAChB,MAAM,UAAU,MAAM,+HAAM,CAAC,OAAO,CAAC,SAAS,CAAC;YAC7C,OAAO;gBACL,IAAI;gBACJ,WAAW;YACb;QACF;QAEA,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,IAAI,SAAS;QACb,IAAI,UAAU;YACZ,SAAS,MAAM,+HAAM,CAAC,YAAY,CAAC,SAAS,CAAC;gBAC3C,OAAO;oBACL,IAAI;oBACJ,WAAW;gBACb;YACF;QACF;QAEA,gCAAgC;QAChC,MAAM,UAAU,MAAM,IAAA,wIAAe,EAAC;YACpC;YACA;YACA;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAQ;IACrC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAA6B,GAC/E;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}